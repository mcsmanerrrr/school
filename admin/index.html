<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCS Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: #f5f5f5;
        }
        
        .login-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .admin-bg {
            background: #f5f5f5;
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
        }

        /* --- STYLES FOR SECTIONED ADMIN PANEL --- */
        .sidebar {
            width: 280px;
            background-color: #343a40;
            color: #ffffff;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            padding-top: 2rem;
            z-index: 10;
            overflow-y: auto;
        }
        .main-content {
            margin-left: 280px;
            padding: 2rem;
            width: calc(100% - 280px);
        }
        .nav-link {
            padding: 0.75rem 1.5rem;
            display: block;
            color: #ccc;
            transition: all 0.2s;
            border-left: 4px solid transparent;
        }
        .nav-link:hover, .nav-link.active {
            background-color: #495057;
            color: #ffffff;
            border-left-color: #00b8e6;
        }
        /* --- END STYLES --- */
        
        .login-card {
            animation: slideUp 0.5s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .section-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            padding: 24px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .section-card:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
        }
        
        .card-header {
            background: #3a4149;
            color: white;
            padding: 16px 20px;
            border-radius: 8px 8px 0 0;
            font-weight: 600;
            font-size: 18px;
            margin: -24px -24px 20px -24px;
        }
        
        .input-field {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn-primary {
            background: #00bcd4;
            color: white;
            padding: 12px 32px;
            border-radius: 8px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            font-size: 15px;
        }
        
        .btn-primary:hover {
            background: #00acc1;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 188, 212, 0.3);
        }

        .btn-secondary {
            background: #6366f1;
            color: white;
            padding: 10px 24px;
            border-radius: 8px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-secondary:hover { background: #4f46e5; }
        
        .btn-delete {
            background: #ef4444;
            color: white;
            padding: 8px 20px;
            border-radius: 6px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
        }
        
        .btn-delete:hover {
            background: #dc2626;
            transform: scale(1.05);
        }
        
        .item-row {
            background: #f9fafb;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #e5e7eb;
            transition: all 0.2s;
        }
        
        .item-row:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }
        
        .label-text {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .logout-btn {
            background: #ef4444;
            color: white;
            padding: 10px 24px;
            border-radius: 8px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            background: #dc2626;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-weight: 500;
            color: #374151;
        }
        
        .checkbox-input {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* Quiz Specific Styles */
        .question-preview {
            border: 1px dashed #cbd5e1;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            background: #fff;
        }
    </style>
</head>
<body>

    <div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-3"></div>

    <div id="custom-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="glass-card w-full max-w-sm p-6 text-center">
            <h3 id="modal-title" class="text-xl font-bold text-gray-800 mb-4"></h3>
            <p id="modal-message" class="text-gray-600 mb-6"></p>
            <div id="modal-actions" class="flex justify-end space-x-3">
                <button id="modal-cancel" class="px-4 py-2 text-gray-600 bg-gray-200 rounded-lg font-semibold hover:bg-gray-300 transition">Cancel</button>
                <button id="modal-confirm" class="px-4 py-2 text-white bg-indigo-600 rounded-lg font-semibold hover:bg-indigo-700 transition">Confirm</button>
            </div>
        </div>
    </div>

    <div id="login-screen" class="login-gradient flex items-center justify-center p-4">
        <div class="login-card glass-card w-full max-w-md p-8">
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-gradient-to-br from-purple-600 to-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
                    <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                    </svg>
                </div>
                <h1 class="text-3xl font-extrabold text-gray-800 mb-2">Admin Login</h1>
                <p class="text-gray-600 font-medium">Maner Central School</p>
            </div>
            
            <div id="login-error" class="hidden mb-4 p-4 bg-red-50 border-l-4 border-red-500 rounded-lg">
                <p class="text-sm text-red-700 font-medium" id="error-text"></p>
            </div>
            
            <form id="login-form" class="space-y-6">
                <div>
                    <label class="label-text">Email Address</label>
                    <input type="email" id="login-email" required class="input-field" placeholder="admin@mcs.in">
                </div>
                
                <div>
                    <label class="label-text">Password</label>
                    <input type="password" id="login-password" required class="input-field" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                
                <button type="submit" id="login-btn" class="btn-primary">
                    <span id="login-btn-text">Sign In</span>
                    <span id="login-btn-loading" class="hidden">Authenticating...</span>
                </button>
            </form>
            
            <div class="mt-6 text-center text-xs text-gray-500">
                üîí Secure admin portal - Authorized access only
            </div>
        </div>
    </div>

    <div id="admin-dashboard" class="hidden flex admin-bg">
        
        <div class="sidebar">
            <div class="px-6 mb-8">
                <h1 class="text-2xl font-extrabold text-white">MCS Admin</h1>
                <p class="text-sm text-gray-400">Content Management</p>
            </div>
            <nav>
                <a href="#" class="nav-link active" data-section="marquee-management-section">Marquee & Notices</a>
                <a href="#" class="nav-link" data-section="news-management-section">News & Events</a>
                <a href="#" class="nav-link" data-section="test-management-section">Manage Tests üìù</a>
                <a href="#" class="nav-link" data-section="circulars-management-section">Circulars</a>
                <a href="#" class="nav-link" data-section="academic-management-section">Academic Links</a>
                <a href="#" class="nav-link" data-section="downloads-management-section">Downloads</a>
                <a href="#" class="nav-link" data-section="gallery-management-section">Gallery üì∏</a>
                <a href="#" class="nav-link" data-section="home-gallery-management-section">Home Gallery üñºÔ∏è</a>
                <a href="#" class="nav-link" data-section="toppers-management-section">Toppers Management üèÜ</a>
                <a href="#" class="nav-link" data-section="banner-management-section">Home Banner üì¢</a>
            </nav>
            <div class="p-6 border-t border-gray-700 mt-auto">
                <p id="admin-info" class="text-sm text-gray-400 mb-2">Logged in as: <span id="admin-email-sidebar"></span></p>
                <button id="logout-btn" class="logout-btn w-full">Log Out</button>
            </div>
        </div>

        <div class="main-content">
            <header class="flex justify-between items-center bg-white p-4 rounded-lg shadow-md mb-6">
                <h2 id="section-title" class="text-2xl font-bold text-gray-800">Marquee & Notices Management</h2>
            </header>

            <section id="marquee-management-section" class="space-y-6">
                <div class="section-card">
                    <div class="card-header">Add New Marquee Notice</div>
                    <form id="form-marquee" class="space-y-4">
                        <div>
                            <label class="label-text">Notice Text (incl. **bold**)</label>
                            <textarea id="marquee-text" required class="input-field" rows="4" placeholder="Enter notice text..."></textarea>
                        </div>
                        <div>
                            <label class="label-text">Display Order (Lower is first)</label>
                            <input type="number" id="marquee-order" class="input-field" value="1" min="1">
                        </div>
                        <button type="submit" class="btn-primary">Add Marquee Notice</button>
                    </form>
                </div>
                <div class="section-card">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üì¢ Current Marquee Notices</h3>
                    <div id="list-marquee"></div>
                </div>
            </section>
            
            <section id="news-management-section" class="space-y-6 hidden">
                <div class="section-card">
                    <div class="card-header">Add Latest News/Event (Links Only)</div>
                    <form id="form-news" class="space-y-4">
                        <div>
                            <label class="label-text">Title</label>
                            <input type="text" id="news-title" required class="input-field" placeholder="News title">
                        </div>
                        <div>
                            <label class="label-text">Link URL</label>
                            <input type="url" id="news-url" class="input-field" placeholder="https://...">
                        </div>
                        <div>
                            <label class="label-text">Date (YYYY-MM-DD)</label>
                            <input type="date" id="news-date" required class="input-field">
                        </div>
                        <div>
                            <label class="label-text">Category (Optional, leave blank for general)</label>
                            <input type="text" id="news-category" class="input-field" placeholder="e.g., academic, sport">
                        </div>
                        <button type="submit" class="btn-primary">Add News Item</button>
                    </form>
                </div>
                <div class="section-card">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üì∞ Current News & Events</h3>
                    <div id="list-news"></div>
                </div>
            </section>

            <section id="test-management-section" class="space-y-6 hidden">
                <div class="section-card">
                    <div class="card-header">Create New Test</div>
                    
                    <div class="mb-6 border-b pb-6">
                        <label class="label-text">Test Title</label>
                        <input type="text" id="new-test-title" class="input-field" placeholder="e.g. Mathematics Final Exam - Term 1">
                    </div>

                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 mb-6">
                        <h4 class="font-bold text-gray-700 mb-4">Add Questions</h4>
                        
                        <div class="mb-4">
                            <label class="label-text">Question Text</label>
                            <textarea id="q-text" class="input-field" rows="2" placeholder="What is the capital of India?"></textarea>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="label-text">Option 1</label>
                                <input type="text" id="q-opt1" class="input-field" placeholder="Answer A">
                            </div>
                            <div>
                                <label class="label-text">Option 2</label>
                                <input type="text" id="q-opt2" class="input-field" placeholder="Answer B">
                            </div>
                            <div>
                                <label class="label-text">Option 3</label>
                                <input type="text" id="q-opt3" class="input-field" placeholder="Answer C">
                            </div>
                            <div>
                                <label class="label-text">Option 4</label>
                                <input type="text" id="q-opt4" class="input-field" placeholder="Answer D">
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="label-text">Correct Option</label>
                            <select id="q-correct" class="input-field">
                                <option value="option1">Option 1</option>
                                <option value="option2">Option 2</option>
                                <option value="option3">Option 3</option>
                                <option value="option4">Option 4</option>
                            </select>
                        </div>

                        <button type="button" onclick="addQuestionToDraft()" class="btn-secondary w-full">‚ûï Add Question to Test</button>
                    </div>

                    <div id="test-draft-preview" class="mb-6 hidden">
                        <h4 class="font-bold text-gray-700 mb-2">Questions Added (<span id="q-count">0</span>)</h4>
                        <div id="questions-list-container" class="space-y-3 mb-4"></div>
                        <button onclick="publishTest()" class="btn-primary bg-green-600 hover:bg-green-700">‚úÖ Publish Test</button>
                    </div>
                </div>

                <div class="section-card">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üìù Active Tests</h3>
                    <div id="list-tests"></div>
                </div>
            </section>
            <section id="circulars-management-section" class="space-y-6 hidden">
                <div class="section-card">
                    <div class="card-header">Add New Official Circular</div>
                    <form id="form-circulars" class="space-y-4">
                        <div>
                            <label class="label-text">Circular Title</label>
                            <input type="text" id="circular-title" required class="input-field" placeholder="E.g., Fee Payment Schedule...">
                        </div>
                        <div>
                            <label class="label-text">Link URL (PDF)</label>
                            <input type="url" id="circular-url" required class="input-field" placeholder="https://mcs.in/circulars/...">
                        </div>
                        <div>
                            <label class="label-text">Date (YYYY-MM-DD)</label>
                            <input type="date" id="circular-date" required class="input-field">
                        </div>
                        <div>
                            <label class="checkbox-label">
                                <input type="checkbox" id="circular-new" class="checkbox-input">
                                Mark as "New!"
                            </label>
                        </div>
                        <button type="submit" class="btn-primary">Add Circular</button>
                    </form>
                </div>
                <div class="section-card">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üìã Current Official Circulars</h3>
                    <div id="list-circulars"></div>
                </div>
            </section>

            <section id="academic-management-section" class="space-y-6 hidden">
                <div class="section-card">
                    <div class="card-header">Add New Academic Link</div>
                    <form id="form-academic-links" class="space-y-4">
                        <div>
                            <label class="label-text">Link Title</label>
                            <input type="text" id="academic-link-title" required class="input-field" placeholder="e.g., CBSE Portal">
                        </div>
                        <div>
                            <label class="label-text">URL</label>
                            <input type="url" id="academic-link-url" required class="input-field" placeholder="https://...">
                        </div>
                        <button type="submit" class="btn-primary">Add Academic Link</button>
                    </form>
                </div>
                <div class="section-card">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üîó Current Academic Links</h3>
                    <div id="list-academic"></div>
                </div>
            </section>

            <section id="downloads-management-section" class="space-y-6 hidden">
                <div class="section-card">
                    <div class="card-header">Add New Downloadable Document</div>
                    <form id="form-downloads" class="space-y-4">
                        <div>
                            <label class="label-text">Document Title</label>
                            <input type="text" id="download-title" required class="input-field" placeholder="e.g., Admission Form">
                        </div>
                        <div>
                            <label class="label-text">URL</label>
                            <input type="url" id="download-url" required class="input-field" placeholder="https://...">
                        </div>
                        <button type="submit" class="btn-primary">Add Download</button>
                    </form>
                </div>
                <div class="section-card">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üì• Current Downloads</h3>
                    <div id="list-downloads"></div>
                </div>
            </section>

            <section id="gallery-management-section" class="space-y-6 hidden">
                <div class="section-card">
                    <div class="card-header">Add New Gallery Image (General School Photos)</div>
                    <form id="form-gallery-image" class="space-y-4">
                        <div>
                            <label class="label-text">Image Title/Caption</label>
                            <input type="text" id="gallery-image-title" required class="input-field" placeholder="Image Title (e.g., Annual Day 2026)">
                        </div>
                        <div>
                            <label class="label-text">Image URL (Direct Link)</label>
                            <input type="url" id="gallery-image-url-input" required class="input-field" placeholder="https://mcs.in/images/photo.jpg">
                        </div>
                        <div>
                            <label class="label-text">Date (YYYY-MM-DD)</label>
                            <input type="date" id="gallery-image-date" required class="input-field">
                        </div>
                        <button type="submit" class="btn-primary">Add Gallery Image</button>
                    </form>
                </div>

                <div class="section-card">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üì∏ Current Gallery Images</h3>
                    <div id="list-gallery"></div>
                </div>
            </section>
            
            <section id="home-gallery-management-section" class="space-y-6 hidden">
                <div class="section-card">
                    <div class="card-header">Add New Home Gallery Image (For Homepage Carousel/Grid)</div>
                    <form id="form-home-gallery" class="space-y-4">
                        <div>
                            <label class="label-text">Image Title/Caption</label>
                            <input type="text" id="home-gallery-title" required class="input-field" placeholder="E.g., School Building">
                        </div>
                        <div>
                            <label class="label-text">Image URL (Direct Link)</label> 
                            <input type="url" id="home-gallery-image-url" required class="input-field" placeholder="https://mcs.in/images/homepage_hero.jpg">
                        </div>
                        <div>
                            <label class="label-text">Link URL (Optional, link to full page)</label>
                            <input type="url" id="home-gallery-link-url" class="input-field" placeholder="https://mcs.in/about">
                        </div>
                        <button type="submit" class="btn-primary">Add Home Gallery Image</button>
                    </form>
                </div>

                <div class="section-card">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üñºÔ∏è Current Home Gallery Images</h3>
                    <div id="list-home-gallery"></div>
                </div>
            </section>
            
            <section id="toppers-management-section" class="space-y-6 hidden">
                <div class="section-card">
                    <div class="card-header">Add New Academic Topper</div>
                    <form id="form-toppers" class="space-y-4">
                        <div>
                            <label class="label-text">Topper's Name</label>
                            <input type="text" id="topper-name" required class="input-field" placeholder="E.g., Sneha Kumari">
                        </div>
                        <div>
                            <label class="label-text">Percentage/Score</label>
                            <input type="text" id="topper-percentage" required class="input-field" placeholder="E.g., 97% or 485/500">
                        </div>
                        <div>
                            <label class="label-text">Position</label>
                            <input type="text" id="topper-position" required class="input-field" placeholder="E.g., 1st Position">
                        </div>
                        <div>
                            <label class="label-text">Detail/Class (E.g., 10th CBSE)</label>
                            <input type="text" id="topper-detail" required class="input-field" placeholder="E.g., 10th C.B.S.E. or 12th Science">
                        </div>
                        <div>
                            <label class="label-text">Image URL (Direct Link - Portrait format recommended)</label>
                            <input type="url" id="topper-image-url" required class="input-field" placeholder="https://mcs.in/images/topper.jpg">
                        </div>
                        <div>
                            <label class="label-text">Display Order (Lower number appears first)</label>
                            <input type="number" id="topper-order" class="input-field" value="1" min="1">
                        </div>
                        <button type="submit" class="btn-primary">Add Topper</button>
                    </form>
                </div>

                <div class="section-card">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üèÜ Current Academic Toppers</h3>
                    <div id="list-toppers"></div>
                </div>
            </section>
            <section id="banner-management-section" class="space-y-6 hidden">
                <div class="section-card">
                    <div class="card-header">Home Popup Banner Content</div>
                    <form id="form-banner" onsubmit="event.preventDefault(); saveBannerData();" class="space-y-4">
                        <div>
                            <label class="label-text">Banner Image URL (Required)</label>
                            <input type="url" id="banner-image-url" required class="input-field" placeholder="https://mcs.in/banner.jpg">
                        </div>
                        <div>
                            <label class="label-text">Banner Click URL (Optional)</label>
                            <input type="url" id="banner-link-url" class="input-field" placeholder="https://mcs.in/admissions">
                        </div>
                        <div>
                            <label class="label-text">Banner Title (Optional for tracking/reference)</label>
                            <input type="text" id="banner-title" class="input-field" placeholder="E.g., Admissions Open 2026">
                        </div>
                        <button type="submit" class="btn-primary">üíæ Save Banner Content</button>
                    </form>
                </div>

                <div class="section-card">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Banner Status Control</h3>
                    <div class="p-4 rounded-lg border flex justify-between items-center space-x-4 bg-gray-50">
                        <span class="font-medium text-gray-700">Current Status:</span>
                        <span id="banner-status" class="font-extrabold text-lg text-yellow-600">Loading...</span>
                        <button onclick="toggleBannerStatus()" id="toggle-banner-btn" class="logout-btn !bg-indigo-600 hover:!bg-indigo-700 !w-40" disabled>Toggle</button>
                    </div>
                    <p class="text-sm text-gray-500 mt-2">Use the button to turn the banner ON or OFF on the public website. Status requires an **Image URL** to be set.</p>
                </div>
            </section>
            </div>
    </div>
    
    <script type="module">
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBOlLdFHePu9BeAg-hgpefTez1leuNcGg4",
            authDomain: "mcs-school1.firebaseapp.com",
            projectId: "mcs-school1",
            storageBucket: "mcs-school1.firebasestorage.app",
            messagingSenderId: "867300205787",
            appId: "1:867300205787:web:2127d06bfede974be458fe",
            databaseURL: "https://mcs-school1-default-rtdb.firebaseio.com"
        };

        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
        import { getDatabase, ref, push, set, onValue, remove, get, update } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);

        const loginScreen = document.getElementById('login-screen');
        const adminDashboard = document.getElementById('admin-dashboard');
        const loginForm = document.getElementById('login-form');
        const loginError = document.getElementById('login-error');
        const errorText = document.getElementById('error-text');
        const logoutBtn = document.getElementById('logout-btn');
        const adminEmailSpan = document.getElementById('admin-email-sidebar');

        // --- GLOBAL VARIABLES FOR TEST CREATION ---
        let currentDraftQuestions = [];

        // --- Utility Functions ---
        window.showToast = function(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const colors = { success: 'bg-green-500', error: 'bg-red-500', info: 'bg-blue-500' };
            const toast = document.createElement('div');
            toast.className = `${colors[type]} text-white p-4 rounded-lg shadow-xl text-sm font-semibold transform transition-all duration-300 ease-out translate-x-full opacity-0`;
            toast.textContent = message;
            container.appendChild(toast);
            setTimeout(() => toast.classList.remove('translate-x-full', 'opacity-0'), 10);
            setTimeout(() => { toast.classList.add('translate-x-full', 'opacity-0'); toast.addEventListener('transitionend', () => toast.remove()); }, 4000);
        }

        window.showConfirm = function(title, message, confirmText = 'Confirm', onConfirm) {
            const modal = document.getElementById('custom-modal');
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;
            const confirmBtn = document.getElementById('modal-confirm');
            confirmBtn.textContent = confirmText;
            modal.classList.remove('hidden');
            const handleConfirm = () => { modal.classList.add('hidden'); confirmBtn.removeEventListener('click', handleConfirm); document.getElementById('modal-cancel').removeEventListener('click', handleCancel); onConfirm(); };
            const handleCancel = () => { modal.classList.add('hidden'); confirmBtn.removeEventListener('click', handleConfirm); document.getElementById('modal-cancel').removeEventListener('click', handleCancel); };
            confirmBtn.addEventListener('click', handleConfirm);
            document.getElementById('modal-cancel').addEventListener('click', handleCancel);
        }

        window.deleteItem = function(collection, key) {
            showConfirm('Confirm Deletion', '‚ö†Ô∏è Are you sure you want to delete this item? This action cannot be undone.', 'Delete', async () => {
                try {
                    await remove(ref(database, `${collection}/${key}`));
                    showToast('Item deleted successfully!');
                } catch (error) {
                    console.error('Error deleting item:', error);
                    showToast('Error deleting item: ' + error.message, 'error');
                }
            });
        };
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // --- Section Switching Logic ---
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = e.target.getAttribute('data-section');
                const titleText = e.target.textContent.trim();
                
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                e.target.classList.add('active');
                document.querySelectorAll('.main-content > section').forEach(section => section.classList.add('hidden'));

                const targetSection = document.getElementById(targetId);
                if (targetSection) {
                    targetSection.classList.remove('hidden');
                    document.getElementById('section-title').textContent = titleText.replace(/üì∏|üñºÔ∏è|üì¢|üìù|üèÜ/g, '').trim() + ' Management';
                }

                switch(targetId) {
                    case 'marquee-management-section': loadMarqueeNotices(); break;
                    case 'news-management-section': loadNews(); break;
                    case 'circulars-management-section': loadCirculars(); break;
                    case 'academic-management-section': loadAcademicLinks(); break;
                    case 'downloads-management-section': loadDownloads(); break;
                    case 'gallery-management-section': loadGalleryImages(); break;
                    case 'home-gallery-management-section': loadHomeGalleryImages(); break;
                    case 'toppers-management-section': loadToppers(); break; // NEW
                    case 'banner-management-section': loadBannerData(); break;
                    case 'test-management-section': loadTests(); break;
                }
            });
        });

        // --- Core Application Logic ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                adminEmailSpan.textContent = user.email;
                loginScreen.classList.add('hidden');
                adminDashboard.classList.remove('hidden');
                initializeDashboard();
            } else {
                loginScreen.classList.remove('hidden');
                adminDashboard.classList.add('hidden');
            }
        });

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            try {
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                let message = 'Invalid credentials.';
                if (error.code === 'auth/invalid-credential') message = 'Invalid email or password.';
                errorText.textContent = message;
                loginError.classList.remove('hidden');
                setTimeout(() => loginError.classList.add('hidden'), 5000);
            }
        });

        logoutBtn.addEventListener('click', () => {
            showConfirm('Confirm Logout', 'Sign out of Admin Panel?', 'Logout', () => signOut(auth));
        });

        function initializeDashboard() {
            loadMarqueeNotices();
            loadBannerData();

            // --- Existing Form Handlers ---
            document.getElementById('form-marquee').addEventListener('submit', async (e) => {
                e.preventDefault();
                const text = document.getElementById('marquee-text').value;
                const order = document.getElementById('marquee-order').value;
                if (!text.trim()) return showToast('Enter notice text', 'info');
                try {
                    await set(push(ref(database, 'marquee_notices')), { text: text.trim(), order: parseInt(order)||1, createdAt: new Date().toISOString() });
                    document.getElementById('form-marquee').reset();
                    showToast('Notice added!');
                } catch (error) { showToast(error.message, 'error'); }
            });

            document.getElementById('form-news').addEventListener('submit', async (e) => {
                e.preventDefault();
                const title = document.getElementById('news-title').value;
                const url = document.getElementById('news-url').value || '#';
                const date = document.getElementById('news-date').value;
                const category = document.getElementById('news-category').value || 'general';
                if (!title.trim() || !date) return showToast('Fill required fields', 'info');
                try {
                    await set(push(ref(database, 'news')), { title: title.trim(), url, date, category: category.trim().toLowerCase(), createdAt: new Date().toISOString() });
                    document.getElementById('form-news').reset();
                    showToast('News added!');
                } catch (error) { showToast(error.message, 'error'); }
            });

            document.getElementById('form-gallery-image').addEventListener('submit', async (e) => {
                e.preventDefault();
                const title = document.getElementById('gallery-image-title').value;
                const imageUrl = document.getElementById('gallery-image-url-input').value;
                const date = document.getElementById('gallery-image-date').value;
                if (!title.trim() || !imageUrl.trim() || !date) return showToast('Fill all fields', 'info');
                try {
                    await set(push(ref(database, 'news')), { title: title.trim(), url: imageUrl.trim(), date, category: 'image', createdAt: new Date().toISOString() });
                    document.getElementById('form-gallery-image').reset();
                    showToast('Gallery Image added!');
                } catch (error) { showToast(error.message, 'error'); }
            });

            document.getElementById('form-home-gallery').addEventListener('submit', async (e) => {
                e.preventDefault();
                const title = document.getElementById('home-gallery-title').value;
                const imageUrl = document.getElementById('home-gallery-image-url').value;
                const url = document.getElementById('home-gallery-link-url').value || '#';
                if (!title.trim() || !imageUrl.trim()) return showToast('Fill required fields', 'info');
                try {
                    await set(push(ref(database, 'gallery')), { title: title.trim(), image: imageUrl.trim(), url, createdAt: new Date().toISOString() });
                    document.getElementById('form-home-gallery').reset();
                    showToast('Home Gallery Image added!');
                } catch (error) { showToast(error.message, 'error'); }
            });

            document.getElementById('form-circulars').addEventListener('submit', async (e) => {
                e.preventDefault();
                const title = document.getElementById('circular-title').value;
                const url = document.getElementById('circular-url').value;
                const date = document.getElementById('circular-date').value;
                const isNew = document.getElementById('circular-new').checked;
                if (!title.trim() || !url.trim() || !date) return showToast('Fill all fields', 'info');
                try {
                    await set(push(ref(database, 'circulars')), { title: title.trim(), url: url.trim(), date, isNew, createdAt: new Date().toISOString() });
                    document.getElementById('form-circulars').reset();
                    showToast('Circular added!');
                } catch (error) { showToast(error.message, 'error'); }
            });

            document.getElementById('form-academic-links').addEventListener('submit', async (e) => {
                e.preventDefault();
                const title = document.getElementById('academic-link-title').value;
                const url = document.getElementById('academic-link-url').value;
                if (!title.trim() || !url.trim()) return showToast('Fill all fields', 'info');
                try {
                    await set(push(ref(database, 'academic_links')), { title: title.trim(), url: url.trim(), createdAt: new Date().toISOString() });
                    document.getElementById('form-academic-links').reset();
                    showToast('Link added!');
                } catch (error) { showToast(error.message, 'error'); }
            });

            document.getElementById('form-downloads').addEventListener('submit', async (e) => {
                e.preventDefault();
                const title = document.getElementById('download-title').value;
                const url = document.getElementById('download-url').value;
                if (!title.trim() || !url.trim()) return showToast('Fill all fields', 'info');
                try {
                    await set(push(ref(database, 'downloads')), { title: title.trim(), url: url.trim(), createdAt: new Date().toISOString() });
                    document.getElementById('form-downloads').reset();
                    showToast('Download added!');
                } catch (error) { showToast(error.message, 'error'); }
            });
            
            // --- NEW: TOPPERS FORM HANDLER ---
            document.getElementById('form-toppers').addEventListener('submit', async (e) => {
                e.preventDefault();
                const name = document.getElementById('topper-name').value;
                const percentage = document.getElementById('topper-percentage').value;
                const position = document.getElementById('topper-position').value;
                const detail = document.getElementById('topper-detail').value;
                const imageUrl = document.getElementById('topper-image-url').value;
                const order = document.getElementById('topper-order').value;

                if (!name.trim() || !percentage.trim() || !position.trim() || !detail.trim() || !imageUrl.trim()) {
                    return showToast('Please fill all required fields.', 'info');
                }

                try {
                    await set(push(ref(database, 'toppers')), { 
                        name: name.trim(), 
                        percentage: percentage.trim(), 
                        position: position.trim(),
                        detail: detail.trim(),
                        imageURL: imageUrl.trim(),
                        order: parseInt(order) || 1,
                        createdAt: new Date().toISOString()
                    });
                    document.getElementById('form-toppers').reset();
                    showToast('Topper added successfully!');
                } catch (error) { 
                    showToast(error.message, 'error'); 
                }
            });
        }
        
        // --- NEW: TEST MANAGEMENT LOGIC ---

        window.addQuestionToDraft = function() {
            const qText = document.getElementById('q-text').value;
            const opt1 = document.getElementById('q-opt1').value;
            const opt2 = document.getElementById('q-opt2').value;
            const opt3 = document.getElementById('q-opt3').value;
            const opt4 = document.getElementById('q-opt4').value;
            const correct = document.getElementById('q-correct').value;

            if(!qText || !opt1 || !opt2 || !opt3 || !opt4) {
                showToast("Please fill in the question and all 4 options.", "info");
                return;
            }

            const newQuestion = {
                question: qText,
                option1: opt1,
                option2: opt2,
                option3: opt3,
                option4: opt4,
                correctOption: correct
            };

            currentDraftQuestions.push(newQuestion);
            renderDraftPreview();
            
            // Clear inputs
            document.getElementById('q-text').value = "";
            document.getElementById('q-opt1').value = "";
            document.getElementById('q-opt2').value = "";
            document.getElementById('q-opt3').value = "";
            document.getElementById('q-opt4').value = "";
            showToast("Question added to draft!");
        };

        function renderDraftPreview() {
            const container = document.getElementById('questions-list-container');
            const previewSection = document.getElementById('test-draft-preview');
            const countSpan = document.getElementById('q-count');
            
            container.innerHTML = "";
            countSpan.innerText = currentDraftQuestions.length;

            if(currentDraftQuestions.length > 0) {
                previewSection.classList.remove('hidden');
                
                currentDraftQuestions.forEach((q, index) => {
                    const div = document.createElement('div');
                    div.className = 'question-preview';
                    div.innerHTML = `
                        <div class="flex justify-between">
                            <h5 class="font-bold text-sm">Q${index+1}: ${escapeHtml(q.question)}</h5>
                            <button onclick="removeQuestionFromDraft(${index})" class="text-red-500 hover:text-red-700 font-bold text-xs">Remove</button>
                        </div>
                        <div class="grid grid-cols-2 gap-2 mt-2 text-xs text-gray-600">
                            <span class="${q.correctOption === 'option1' ? 'text-green-600 font-bold' : ''}">A: ${escapeHtml(q.option1)}</span>
                            <span class="${q.correctOption === 'option2' ? 'text-green-600 font-bold' : ''}">B: ${escapeHtml(q.option2)}</span>
                            <span class="${q.correctOption === 'option3' ? 'text-green-600 font-bold' : ''}">C: ${escapeHtml(q.option3)}</span>
                            <span class="${q.correctOption === 'option4' ? 'text-green-600 font-bold' : ''}">D: ${escapeHtml(q.option4)}</span>
                        </div>
                    `;
                    container.appendChild(div);
                });
            } else {
                previewSection.classList.add('hidden');
            }
        }

        window.removeQuestionFromDraft = function(index) {
            currentDraftQuestions.splice(index, 1);
            renderDraftPreview();
        };

        window.publishTest = async function() {
            const title = document.getElementById('new-test-title').value;
            
            if(!title.trim()) {
                showToast("Please enter a Test Title.", "info");
                return;
            }
            if(currentDraftQuestions.length === 0) {
                showToast("Please add at least one question.", "info");
                return;
            }

            try {
                const newTestRef = push(ref(database, 'tests'));
                await set(newTestRef, {
                    testName: title.trim(),
                    questions: currentDraftQuestions,
                    createdAt: new Date().toISOString()
                });

                showToast("Test Created Successfully!");
                
                // Reset Form
                document.getElementById('new-test-title').value = "";
                currentDraftQuestions = [];
                renderDraftPreview();

            } catch(e) {
                console.error(e);
                showToast("Error creating test: " + e.message, "error");
            }
        };

        function loadTests() {
            const listElement = document.getElementById('list-tests');
            listElement.innerHTML = '<p class="text-gray-500 text-center py-4">Loading active tests...</p>';
            
            onValue(ref(database, 'tests'), (snapshot) => {
                listElement.innerHTML = '';
                const data = snapshot.val();
                
                if (!data) {
                    listElement.innerHTML = '<p class="text-gray-500 text-center py-4">No tests created yet.</p>';
                    return;
                }
                
                Object.entries(data).forEach(([key, item]) => {
                    const qCount = item.questions ? item.questions.length : 0;
                    const div = document.createElement('div');
                    div.className = 'item-row';
                    div.innerHTML = `
                        <div class="flex-1">
                            <p class="font-semibold text-gray-800">${escapeHtml(item.testName)}</p>
                            <p class="text-xs text-gray-500 mt-1">Questions: ${qCount}</p>
                        </div>
                        <button onclick="deleteItem('tests', '${key}')" class="btn-delete">üóëÔ∏è Delete</button>
                    `;
                    listElement.appendChild(div);
                });
            });
        }

        // --- END TEST MANAGEMENT LOGIC ---

        function loadBannerData() {
            const bannerRef = ref(database, 'popup_banner');
            onValue(bannerRef, (snapshot) => {
                const data = snapshot.val();
                const statusElement = document.getElementById('banner-status');
                const toggleBtn = document.getElementById('toggle-banner-btn');
                const imageUrlInput = document.getElementById('banner-image-url');
                const linkUrlInput = document.getElementById('banner-link-url');
                const titleInput = document.getElementById('banner-title');

                if (data) {
                    imageUrlInput.value = data.imageURL || '';
                    linkUrlInput.value = data.linkURL || '';
                    titleInput.value = data.title || '';
                    statusElement.classList.remove('text-green-600', 'text-red-600', 'text-yellow-600');
                    if (data.isActive) {
                        statusElement.textContent = 'ON (Visible)';
                        statusElement.classList.add('text-green-600');
                        toggleBtn.textContent = 'Turn OFF';
                    } else {
                        statusElement.textContent = 'OFF (Hidden)';
                        statusElement.classList.add('text-red-600');
                        toggleBtn.textContent = 'Turn ON';
                    }
                    toggleBtn.disabled = !data.imageURL;
                } else {
                    statusElement.textContent = 'OFF (No Data)';
                    statusElement.classList.add('text-yellow-600');
                    toggleBtn.disabled = true;
                }
            });
        }

        window.saveBannerData = async function() {
            const imageUrl = document.getElementById('banner-image-url').value;
            const linkUrl = document.getElementById('banner-link-url').value;
            const title = document.getElementById('banner-title').value;
            if (!imageUrl) return showToast('Enter Banner Image URL.', 'info');
            try {
                const bannerRef = ref(database, 'popup_banner');
                const snapshot = await get(bannerRef);
                const currentData = snapshot.val() || {};
                await set(bannerRef, { isActive: currentData.isActive || false, imageURL: imageUrl, linkURL: linkUrl || '#', title: title || '', lastUpdated: new Date().toISOString() });
                showToast('Banner saved!');
            } catch (error) { showToast('Error saving banner.', 'error'); }
        }

        window.toggleBannerStatus = async function() {
            try {
                const bannerRef = ref(database, 'popup_banner');
                const snapshot = await get(bannerRef);
                let currentData = snapshot.val() || {};
                if (!currentData.imageURL) return showToast('Save image URL first.', 'info');
                await update(bannerRef, { isActive: !currentData.isActive, lastUpdated: new Date().toISOString() });
                showToast(`Banner turned ${!currentData.isActive ? 'ON' : 'OFF'}`, 'info');
            } catch (error) { showToast('Error toggling banner.', 'error'); }
        }

        function loadMarqueeNotices() {
            const listElement = document.getElementById('list-marquee');
            onValue(ref(database, 'marquee_notices'), (snapshot) => {
                listElement.innerHTML = '';
                const data = snapshot.val();
                if (!data) return listElement.innerHTML = '<p class="text-gray-500 text-center py-4">No notices yet.</p>';
                Object.entries(data).map(([key, value]) => ({ key, ...value })).sort((a, b) => (a.order||999) - (b.order||999)).forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'item-row';
                    div.innerHTML = `<div class="flex-1"><p class="font-semibold text-gray-800">${escapeHtml(item.text)}</p><p class="text-xs text-gray-500 mt-1">Order: ${item.order || 1}</p></div><button onclick="deleteItem('marquee_notices', '${item.key}')" class="btn-delete">üóëÔ∏è Delete</button>`;
                    listElement.appendChild(div);
                });
            });
        }
        
        function loadNews() {
            const listElement = document.getElementById('list-news');
            onValue(ref(database, 'news'), (snapshot) => {
                listElement.innerHTML = '';
                const data = snapshot.val();
                const items = Object.entries(data || {}).map(([key, value]) => ({ key, ...value })).filter(item => item.category !== 'image').sort((a, b) => new Date(b.date) - new Date(a.date));
                if (items.length === 0) return listElement.innerHTML = '<p class="text-gray-500 text-center py-4">No news yet.</p>';
                items.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'item-row';
                    div.innerHTML = `<div class="flex-1"><p class="font-semibold text-gray-800">${escapeHtml(item.title)}</p><p class="text-xs text-gray-500 mt-1">üìÖ ${item.date}</p></div><button onclick="deleteItem('news', '${item.key}')" class="btn-delete">üóëÔ∏è Delete</button>`;
                    listElement.appendChild(div);
                });
            });
        }

        function loadGalleryImages() {
            const listElement = document.getElementById('list-gallery');
            onValue(ref(database, 'news'), (snapshot) => {
                listElement.innerHTML = '';
                const data = snapshot.val();
                const items = Object.entries(data || {}).map(([key, value]) => ({ key, ...value })).filter(item => item.category === 'image').sort((a, b) => new Date(b.date) - new Date(a.date));
                if (items.length === 0) return listElement.innerHTML = '<p class="text-gray-500 text-center py-4">No images yet.</p>';
                items.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'item-row';
                    div.innerHTML = `<div class="flex-1 flex items-center gap-4"><img src="${escapeHtml(item.url)}" class="w-12 h-12 object-cover rounded-md"><p class="font-semibold text-gray-800">${escapeHtml(item.title)}</p></div><button onclick="deleteItem('news', '${item.key}')" class="btn-delete">üóëÔ∏è Delete</button>`;
                    listElement.appendChild(div);
                });
            });
        }

        function loadHomeGalleryImages() {
            const listElement = document.getElementById('list-home-gallery');
            onValue(ref(database, 'gallery'), (snapshot) => {
                listElement.innerHTML = '';
                const data = snapshot.val();
                const items = Object.entries(data || {}).map(([key, value]) => ({ key, ...value })).sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                if (items.length === 0) return listElement.innerHTML = '<p class="text-gray-500 text-center py-4">No home gallery images yet.</p>';
                items.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'item-row';
                    div.innerHTML = `<div class="flex-1 flex items-center gap-4"><img src="${escapeHtml(item.image)}" class="w-12 h-12 object-cover rounded-md"><p class="font-semibold text-gray-800">${escapeHtml(item.title)}</p></div><button onclick="deleteItem('gallery', '${item.key}')" class="btn-delete">üóëÔ∏è Delete</button>`;
                    listElement.appendChild(div);
                });
            });
        }
        
        // --- NEW: TOPPERS LIST LOADER ---
        function loadToppers() {
            const listElement = document.getElementById('list-toppers');
            onValue(ref(database, 'toppers'), (snapshot) => {
                listElement.innerHTML = '';
                const data = snapshot.val();
                if (!data) return listElement.innerHTML = '<p class="text-gray-500 text-center py-4">No toppers added yet.</p>';
                
                Object.entries(data).map(([key, value]) => ({ key, ...value }))
                    .sort((a, b) => (a.order || 999) - (b.order || 999))
                    .forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'item-row';
                    div.innerHTML = `
                        <div class="flex-1 flex items-center gap-4">
                            <img src="${escapeHtml(item.imageURL || 'https://placehold.co/50x70?text=No+Image')}" class="w-12 h-16 object-cover rounded-md">
                            <div>
                                <p class="font-semibold text-gray-800">${escapeHtml(item.name)} (${escapeHtml(item.percentage)})</p>
                                <p class="text-xs text-gray-500 mt-1">${escapeHtml(item.position)} - ${escapeHtml(item.detail)} (Order: ${item.order || 1})</p>
                            </div>
                        </div>
                        <button onclick="deleteItem('toppers', '${item.key}')" class="btn-delete">üóëÔ∏è Delete</button>
                    `;
                    listElement.appendChild(div);
                });
            });
        }
        // --- END: NEW TOPPERS LIST LOADER ---


        function loadCirculars() {
            const listElement = document.getElementById('list-circulars');
            onValue(ref(database, 'circulars'), (snapshot) => {
                listElement.innerHTML = '';
                const data = snapshot.val();
                if (!data) return listElement.innerHTML = '<p class="text-gray-500 text-center py-4">No circulars yet.</p>';
                Object.entries(data).map(([key, value]) => ({ key, ...value })).sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'item-row';
                    div.innerHTML = `<div class="flex-1"><p class="font-semibold text-gray-800">${escapeHtml(item.title)}</p><a href="${escapeHtml(item.url)}" target="_blank" class="text-xs text-blue-600 hover:underline mt-1 inline-block">üìÑ View PDF</a></div><button onclick="deleteItem('circulars', '${item.key}')" class="btn-delete">üóëÔ∏è Delete</button>`;
                    listElement.appendChild(div);
                });
            });
        }

        function loadAcademicLinks() {
            const listElement = document.getElementById('list-academic');
            onValue(ref(database, 'academic_links'), (snapshot) => {
                listElement.innerHTML = '';
                const data = snapshot.val();
                if (!data) return listElement.innerHTML = '<p class="text-gray-500 text-center py-4">No links yet.</p>';
                Object.entries(data).forEach(([key, item]) => {
                    const div = document.createElement('div');
                    div.className = 'item-row';
                    div.innerHTML = `<div class="flex-1"><p class="font-semibold text-gray-800">${escapeHtml(item.title)}</p><a href="${escapeHtml(item.url)}" target="_blank" class="text-xs text-blue-600 hover:underline">Link</a></div><button onclick="deleteItem('academic_links', '${key}')" class="btn-delete">üóëÔ∏è Delete</button>`;
                    listElement.appendChild(div);
                });
            });
        }

        function loadDownloads() {
            const listElement = document.getElementById('list-downloads');
            onValue(ref(database, 'downloads'), (snapshot) => {
                listElement.innerHTML = '';
                const data = snapshot.val();
                if (!data) return listElement.innerHTML = '<p class="text-gray-500 text-center py-4">No downloads yet.</p>';
                Object.entries(data).forEach(([key, item]) => {
                    const div = document.createElement('div');
                    div.className = 'item-row';
                    div.innerHTML = `<div class="flex-1"><p class="font-semibold text-gray-800">${escapeHtml(item.title)}</p></div><button onclick="deleteItem('downloads', '${key}')" class="btn-delete">üóëÔ∏è Delete</button>`;
                    listElement.appendChild(div);
                });
            });
        }
    </script>

</body>
</html>
