<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maner Central School - Maner, Patna 801108</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff; 
        }
        .school-primary {
            background-color: #343a40;
        }
        .school-primary-text {
            color: #343a40;
        }
        .school-accent-bg {
            background-color: #00b8e6;
        }
        .school-accent-text {
            color: #00b8e6;
        }
        .institutional-border {
            border-bottom: 4px solid #00b8e6;
        }
        .sidebar-link {
            transition: all 0.2s;
        }
        .sidebar-link:hover {
            background-color: #f8f9fa; 
            border-left-color: #343a40;
        }
        .marquee-container {
            background-color: #00b8e6;
            color: #FFFFFF;
            font-weight: 600;
            border-bottom: 2px solid #343a40;
            overflow: hidden;
        }
        .hero-banner {
            background-image: url('images/background.png');
            background-size: cover;
            background-position: center;
            position: relative;
        }
        .hero-overlay {
            background-color: rgba(52, 58, 64, 0.7);
        }
        .principal-image {
             min-width: 60px;
        }
        .gallery-item {
            position: relative;
            overflow: hidden;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }
        .gallery-item:hover {
            transform: scale(1.03);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -4px rgba(0, 0, 0, 0.2);
        }
        .gallery-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0));
            color: white;
            padding: 1rem 0.75rem 0.5rem;
            font-weight: 600;
            text-align: center;
            font-size: 0.875rem;
        }
        /* START: New Popup Banner Styles */
        .animate-scale-in {
            animation: scaleIn 0.5s ease-out forwards;
        }
        .animate-scale-out {
            animation: scaleOut 0.3s ease-in forwards;
        }
        @keyframes scaleIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        @keyframes scaleOut {
            from { transform: scale(1); opacity: 1; }
            to { transform: scale(0.8); opacity: 0; }
        }
        @keyframes pulse-live {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.01); }
        }
        .banner-pulse {
            animation: pulse-live 3s ease-in-out infinite;
        }
        /* END: New Popup Banner Styles */
        
        /* UPDATED: Topper Styles (Compact) */
        .topper-card {
            scroll-snap-align: start;
            flex: 0 0 45%; 
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            cursor: pointer;
            padding: 0.5rem; 
        }
        .topper-card:hover {
             transform: translateY(-5px);
             box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -4px rgba(0, 0, 0, 0.2);
        }
        .topper-image-container {
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2 px 4px -2px rgba(0, 0, 0, 0.1);
            position: relative;
            border: 3px solid #00b8e6; 
        }
        .topper-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            aspect-ratio: 1 / 1.25; 
            display: block;
        }
        .topper-caption {
            position: absolute;
            top: 0; 
            left: 0;
            right: 0;
            background: rgba(0, 184, 230, 0.9); 
            color: white;
            padding: 0.25rem 0.25rem; 
            font-weight: 800; 
            text-align: center;
            font-size: 0.75rem; 
            line-height: 1.2;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); 
        }
        /* Topper Slider Container */
        .toppers-scroll-container {
            overflow-x: scroll;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
        }
        .toppers-scroll-container::-webkit-scrollbar {
            height: 8px;
        }
        .toppers-scroll-container::-webkit-scrollbar-thumb {
            background: #00b8e6;
            border-radius: 10px;
        }
        .toppers-scroll-container::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        @media (min-width: 640px) { /* sm */
            .topper-card {
                flex: 0 0 30%; 
            }
        }
        @media (min-width: 1024px) { /* lg */
            .topper-card {
                flex: 0 0 18%; 
            }
        }

        /* NEW: Celebration Overlay Styles (Pure JS/CSS Confetti Method) */
        #celebration-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999 !important; 
            pointer-events: none !important; 
            overflow: hidden; 
            transition: opacity 0.5s ease-out; 
            background: rgba(255, 255, 255, 0); 
        }

        .confetti-particle {
            position: absolute;
            font-size: 1.5rem;
            opacity: 1;
            /* Use transition for the animation effect */
            transition: transform 0ms linear, opacity 0ms linear; 
            will-change: transform, opacity;
        }
    </style>
   <link rel="apple-touch-icon" sizes="180x180" href="https://manercentralschool.in/images/logo.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://manercentralschool.in/images/logo.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://manercentralschool.in/images/logo.png">
<link rel="manifest" href="images/site.webmanifest">
</head>
<body class="antialiased">

    <header class="school-primary shadow-xl sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16 md:h-20">
                <div class="flex-shrink-0 flex items-center">
                    <img class="h-12 w-auto md:h-16 mr-2 md:mr-4" src="images/logo.png" alt="Maner Central School Logo">
                    <div>
                        <span class="text-white text-lg sm:text-xl md:text-2xl font-extrabold tracking-tight block leading-tight">Maner Central School</span>
                        <span class="text-white text-xs sm:text-sm md:text-lg font-light block leading-none">Patna, Bihar (CBSE)</span>
                    </div>
                </div>
                <nav class="hidden md:flex space-x-6 items-center">
                  <a href="https://manercentralschool.in/test/" class="text-white font-medium hover:text-gray-300 transition duration-150 py-3">Test</a>
                    <a href="https://manercentralschool.in/admission/" class="text-white font-medium hover:text-gray-300 transition duration-150 py-3">Admission</a>
                    <a href="https://manercentralschool.in/payfee/" class="text-white font-medium hover:text-gray-300 transition duration-150 py-3">Student Login</a>
                    <a href="https://manercentralschool.in/admin/" class="text-white font-medium hover:text-gray-300 transition duration-150 py-3">School Login</a>
                </nav>
                <button id="mobile-menu-btn" class="md:hidden p-2 rounded-md text-white hover:bg-gray-700 transition duration-150">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden pb-3 bg-gray-700">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="https://manercentralschool.in/test/" class="text-white hover:bg-gray-600 block px-3 py-2 rounded-md text-base font-medium">Test</a>
                <a href="https://manercentralschool.in/admission/" class="text-white hover:bg-gray-600 block px-3 py-2 rounded-md text-base font-medium">Admission</a>
                <a href="https://manercentralschool.in/payfee/" class="text-white hover:bg-gray-600 block px-3 py-2 rounded-md text-base font-medium">Student Login</a>
                <a href="https://manercentralschool.in/admin/" class="text-white hover:bg-gray-600 block px-3 py-2 rounded-md text-base font-medium">School Login</a>
            </div>
        </div>
    </header>

    <div class="marquee-container py-2">
        <div class="max-w-7xl mx-auto px-4 flex items-center">
            <span class="school-primary-text bg-white px-3 py-0.5 rounded-full mr-4 uppercase text-xs font-extrabold flex-shrink-0">NOTICE</span>
            <marquee class="flex-1 text-sm" id="marquee-notices">Loading...</marquee>
        </div>
    </div>

    <main>
        <section class="hero-banner shadow-lg">
            <div class="hero-overlay py-12 md:py-24">
                <div class="max-w-7xl mx-auto px-4 text-center text-white">
                    <h1 class="text-3xl sm:text-4xl lg:text-7xl font-extrabold mb-4 tracking-tight">
                        Maner Central School
                    </h1>
                    <p class="text-base sm:text-lg font-light mb-6 max-w-3xl mx-auto">
                        <span class="font-bold">A Kamala Educational Social Welfare and Trust Conducting Institute</span><br>
                        Nurturing potential and shaping futures through holistic development and academic rigor in Patna.
                    </p>
                    <a href="https://www.manercentralschool.in/admission" class="inline-block school-accent-bg text-gray-900 font-bold py-3 px-8 rounded-full text-md sm:text-lg shadow-2xl hover:bg-cyan-400 transition duration-300 transform hover:scale-105">
                        Apply for Admission
                    </a>
                </div>
            </div>
        </section>
        
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 grid grid-cols-1 lg:grid-cols-4 gap-6">

            <section class="lg:col-span-2 space-y-6 order-2 lg:order-1">
                <div class="bg-white p-5 rounded-lg shadow-md border-t-8 border-school-accent-bg">
                    <h2 class="text-lg sm:text-xl font-extrabold school-primary-text mb-3 institutional-border inline-block pb-1">
                        MANER CENTRAL SCHOOL AT A GLANCE
                    </h2>
                    <p class="text-gray-700 mb-4 text-sm leading-relaxed">
                        Maner Central School is a premier Co-educational institution located in Patna, Bihar. We are dedicated to providing a comprehensive CBSE curriculum from Pre-Nursery to Class XII, focusing on intellectual, physical, and moral development.
                    </p>
                    <div class="grid grid-cols-2 gap-4 text-center">
                        <div class="bg-gray-100 p-3 rounded-md border border-gray-200">
                            <p class="school-primary-text text-xl font-bold">16+</p>
                            <p class="text-xs text-gray-600">Years of Educational Service</p>
                        </div>
                        <div class="bg-gray-100 p-3 rounded-md border border-gray-200">
                            <p class="school-primary-text text-xl font-bold">2000+</p>
                            <p class="text-xs text-gray-600">Students Enrolled</p>
                        </div>
                        <div class="bg-gray-100 p-3 rounded-md border border-gray-200">
                            <p class="school-primary-text text-xl font-bold">A+</p>
                            <p class="text-xs text-gray-600">Infrastructure & Labs</p>
                        </div>
                        <div class="bg-gray-100 p-3 rounded-md border border-gray-200">
                            <p class="school-primary-text text-xl font-bold">100%</p>
                            <p class="text-xs text-gray-600">Pass Rate (CBSE)</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-5 rounded-lg shadow-md">
                    <h2 class="text-lg sm:text-xl font-extrabold school-primary-text mb-4 institutional-border inline-block pb-1">
                        MESSAGES FROM THE LEADERSHIP
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="p-4 border border-gray-100 rounded-lg shadow-sm">
                            <h3 class="text-md font-extrabold school-accent-text mb-3">PRINCIPAL'S ADDRESS</h3>
                            <div class="flex items-start space-x-4">
                                <img class="principal-image w-16 h-16 rounded-full object-cover shadow-md flex-shrink-0" src="https://placehold.co/64x64/343a40/00b8e6?text=P1" alt="Principal Photo">
                                <div>
                                    <p class="font-bold text-gray-800">Manoj Kumar Singh</p>
                                    <p class="text-xs text-gray-500 mb-2">Principal, Maner Central School</p>
                                </div>
                            </div>
                            <p class="text-gray-700 text-sm italic mt-3 leading-relaxed">
                                "Our core vision is centered on creating a learning environment that encourages curiosity, resilience, and a deep sense of community. We strive to provide a foundation that is both academically rigorous and rich in ethical values."
                            </p>
                        </div>
                        <div class="p-4 border border-gray-100 rounded-lg shadow-sm">
                            <h3 class="text-md font-extrabold school-accent-text mb-3">DIRECTOR'S NOTE</h3>
                            <div class="flex items-start space-x-4">
                                <img class="principal-image w-16 h-16 rounded-full object-cover shadow-md flex-shrink-0" src="https://placehold.co/64x64/00b8e6/343a40?text=DIR" alt="Director Photo">
                                <div>
                                    <p class="font-bold text-gray-800">Anand Kumar Singh</p>
                                    <p class="text-xs text-gray-500 mb-2">Director, Maner Central School</p>
                                </div>
                            </div>
                            <p class="text-gray-700 text-sm italic mt-3 leading-relaxed">
                                "Our focus is on the strategic growth and global readiness of our students. We are committed to fostering an environment of innovation, ensuring our curriculum remains cutting-edge."
                            </p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-5 rounded-lg shadow-md">
                    <h2 class="text-lg sm:text-xl font-extrabold school-primary-text mb-3 institutional-border inline-block pb-1">
                        LATEST NEWS & EVENTS
                    </h2>
                    <div class="space-y-4" id="latest-news-list">
                        <div class="text-sm text-gray-500">Loading...</div>
                    </div>
                    <div class="mt-4 text-right">
                        <a href="#" class="text-sm school-primary-text font-bold hover:underline">View All News &raquo;</a>
                    </div>
                </div>
            </section>

            <section class="lg:col-span-1 space-y-6 order-1 lg:order-2">
                <div class="bg-white p-4 rounded-lg shadow-md border-l-4 border-school-primary-text">
                    <h2 class="text-lg font-extrabold school-primary-text mb-3 institutional-border inline-block pb-1">
                        ACADEMIC LINKS
                    </h2>
                    <ul class="space-y-1" id="academic-links-list">
                        <li class="text-sm text-gray-500 p-2">Loading...</li>
                    </ul>
                </div>

                <div class="bg-white p-4 rounded-lg shadow-md border-l-4 border-school-primary-text">
                    <h2 class="text-lg font-extrabold school-primary-text mb-3 institutional-border inline-block pb-1">
                        DOWNLOADS
                    </h2>
                    <ul class="space-y-1" id="downloads-list">
                        <li class="text-sm text-gray-500 p-2">Loading...</li>
                    </ul>
                </div>
            </section>

            <section class="lg:col-span-1 space-y-6 order-3 lg:order-3">
                <div class="bg-white p-4 rounded-lg shadow-md border-l-4 border-school-accent-bg">
                    <h2 class="text-lg sm:text-xl font-extrabold school-accent-text mb-3 institutional-border inline-block pb-1">
                        OFFICIAL CIRCULARS
                    </h2>
                    <ul class="space-y-1" id="official-circulars-list">
                        <li class="text-sm text-gray-500 p-2">Loading...</li>
                    </ul>
                    <a href="#" class="mt-4 inline-block text-sm school-accent-text font-bold hover:underline">Archive of Circulars &raquo;</a>
                </div>

                <div class="bg-white p-4 rounded-lg shadow-md border-l-4 border-school-accent-bg">
                    <h2 class="text-lg sm:text-xl font-extrabold school-primary-text mb-3 institutional-border inline-block pb-1">
                        IMPORTANT CONTACTS
                    </h2>
                    <ul class="space-y-2 text-sm text-gray-700">
                        <li class="font-semibold">Admission Coordinator: <span class="block font-normal text-gray-600">930-806-9419 (10 AM - 3 PM)</span></li>
                        <li class="font-semibold">General Enquiry / WhatsApp: <span class="block font-normal school-accent-text font-bold">930-806-9419</span></li>
                        <li class="font-semibold">School Helpline: <span class="block font-normal text-gray-600">930-806-9419</span></li>
                        <li class="font-semibold">Contact Mail: <span class="block font-normal text-gray-600">formsatmcsschool@gmail.com</span></li>
                    </ul>
                </div>
            </section>
        </div>
        
        <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
            <h2 class="text-2xl sm:text-3xl font-extrabold school-primary-text mb-6 institutional-border inline-block pb-2">
                SCHOOL GALLERY & MOMENTS
            </h2>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="gallery-grid">
                <div class="col-span-full text-center text-gray-500 py-10">Loading Gallery...</div>
            </div>
            
            <div class="mt-8 text-center">
                <a href="https://www.manercentralschool.in/gallery" class="inline-block school-accent-bg text-gray-900 font-bold py-3 px-8 rounded-full shadow-xl hover:bg-cyan-400 transition duration-300 transform hover:scale-105">
                    View Complete Gallery
                </a>
            </div>
        </section>

        <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12 bg-gray-50 rounded-lg shadow-inner">
            <h2 class="text-2xl sm:text-3xl font-extrabold school-primary-text mb-6 institutional-border inline-block pb-2">
                <span class="school-accent-text">‚ú®</span> OUR TOPPERS <span class="school-accent-text">üèÜ</span>
            </h2>
            
            <div id="toppers-list-container" class="toppers-scroll-container flex space-x-4 pb-4">
                <div class="flex-shrink-0 w-full text-center text-gray-500 py-10">Loading Toppers...</div>
            </div>
            
        </section>
        <section class="school-primary py-10">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h2 class="text-xl sm:text-3xl font-extrabold text-white mb-2">Affiliated to the Central Board of Secondary Education (CBSE)</h2>
                <p class="text-sm sm:text-lg text-gray-300 mb-6">
                    Committed to providing quality education as per national standards.
                </p>
                <a href="https://www.cbse.gov.in/" class="inline-block school-accent-bg text-gray-900 font-bold py-3 px-8 rounded-full shadow-2xl hover:bg-cyan-400 transition duration-300 transform hover:scale-105 text-sm sm:text-base">
                    Visit CBSE Official Website
                </a>
            </div>
        </section>
    </main>

    <footer class="bg-gray-800 text-white py-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 grid grid-cols-2 md:grid-cols-4 gap-8">
            <div>
                <h3 class="text-base sm:text-lg font-bold school-accent-text mb-4">About MCS</h3>
                <ul class="space-y-2 text-sm text-gray-400">
                    <li><a href="https://manercentralschool.in/info" class="hover:text-cyan-400 transition duration-150">Vision & Mission</a></li>
                    <li><a href="https://manercentralschool.in/info" class="hover:text-cyan-400 transition duration-150">Infrastructure</a></li>
                    <li><a href="https://manercentralschool.in/info" class="hover:text-cyan-400 transition duration-150">Careers at MCS</a></li>
                </ul>
            </div>
            <div>
                <h3 class="text-base sm:text-lg font-bold mb-4">Quick Access</h3>
                <ul class="space-y-2 text-sm text-gray-400">
                    <li><a href="https://www.manercentralschool.in/admin/" class="hover:text-cyan-400 transition duration-150">Staff Login</a></li>
                    <li><a href="https://www.manercentralschool.in/payfee_admin/" class="hover:text-cyan-400 transition duration-150">Alumni Registration</a></li>
                    <li><a href="https://www.manercentralschool.in/payfee/" class="hover:text-cyan-400 transition duration-150">Student login</a></li>
                </ul>
            </div>
            <div class="col-span-2 md:col-span-1">
                <h3 class="text-base sm:text-lg font-bold mb-4">Locate Us</h3>
                <p class="text-sm text-gray-400">
                    Maner Central School Campus,<br>
                    Ramadhar Nagar, Maner, Patna - 801108, Bihar<br>
                    Phone: 930-806-9419
                </p>
            </div>
            <div>
                <h3 class="text-base sm:text-lg font-bold mb-4">Social Media</h3>
                <p class="text-sm text-gray-400">
                    Follow us for daily updates on student life and achievements!
                </p>
                <div class="mt-3 flex space-x-3 text-2xl">
                  <ul class="space-y-2 text-sm text-gray-400">
                    <li><a href="https://www.manercentralschool.in/admin/" class="hover:text-cyan-400 transition duration-150">Facebook</a></li>
                    <li><a href="https://www.manercentralschool.in/payfee_admin/" class="hover:text-cyan-400 transition duration-150">Instagram</a></li>
                    <li><a href="https://www.youtube.com/@MANERCENTRALSCHOOL" class="hover:text-cyan-400 transition duration-150">Youtube</a></li>
                </ul>
                </div>
            </div>
        </div>
        <div class="mt-8 text-center text-gray-500 text-sm border-t border-gray-700 pt-4">
            &copy; 2026 Maner Central School. All rights reserved. 
            <a href="https://manercentralschool.in/harshitsingh" class="text-gray-500 hover:text-cyan-400 transition duration-150">Designed by Harshit Singh</a>
        </div>
    </footer>

    <div id="popup-banner-container" class="fixed inset-0 z-[100] hidden bg-black bg-opacity-70 flex items-center justify-center p-4">
        <div id="popup-banner" class="bg-white rounded-lg shadow-2xl relative w-auto max-w-[90vw] md:max-w-4xl max-h-[90vh] flex flex-col">
            <button id="popup-close-btn" class="absolute top-[-15px] right-[-15px] bg-red-600 text-white rounded-full h-8 w-8 flex items-center justify-center font-bold text-lg hover:bg-red-700 transition z-50">
                &times;
            </button>
            <a id="popup-link" href="#" target="_blank" class="block w-full h-full overflow-hidden rounded-lg">
                <img id="popup-image" src="" alt="Popup Banner" class="w-full h-auto max-h-[85vh] object-contain banner-pulse block mx-auto">
            </a>
        </div>
    </div>
    
    <div id="celebration-overlay" class="hidden"></div>
    
    <script type="module">
        const firebaseConfig = {
            databaseURL: "https://mcs-school1-default-rtdb.firebaseio.com/"
        };

        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

        let database;
        let isDbReady = false;

        function fetchAndRenderMarqueeNotices() {
            const marqueeElement = document.getElementById('marquee-notices');
            if (!marqueeElement || !isDbReady) return;

            const noticesRef = ref(database, 'marquee_notices');
            onValue(noticesRef, (snapshot) => {
                let notices = [];
                const data = snapshot.val();
                
                if (data) {
                    Object.values(data).forEach((item) => {
                        if (item.text) notices.push(item.text);
                    });
                }
                
                if (notices.length === 0) {
                    marqueeElement.textContent = "No urgent notices currently available.";
                } else {
                    marqueeElement.innerHTML = notices.join(' &bull; &bull; &bull; ');
                }
            }, (error) => {
                console.error('Database Error:', error);
                marqueeElement.textContent = "Error loading notices.";
            });
        }

        function fetchAndRenderSimpleList(pathName, elementId, linkClassName) {
            const listElement = document.getElementById(elementId);
            if (!listElement || !isDbReady) return;

            const listRef = ref(database, pathName);
            onValue(listRef, (snapshot) => {
                listElement.innerHTML = '';
                const data = snapshot.val();
                
                if (!data) {
                    listElement.innerHTML = '<li class="text-sm text-gray-500 p-2">No items available.</li>';
                    return;
                }

                Object.values(data).forEach(item => {
                    if (item.title) {
                        const li = document.createElement('li');
                        li.innerHTML = `<a href="${item.url || '#'}" class="${linkClassName} block p-2 text-gray-700 font-medium border-l-2 border-transparent hover:border-l-4 border-school-primary-text hover:bg-gray-50">${item.title}</a>`;
                        listElement.appendChild(li);
                    }
                });
            }, (error) => {
                console.error('Database Error:', error);
                listElement.innerHTML = '<li class="text-sm text-red-500 p-2">Error loading data.</li>';
            });
        }

        function fetchAndRenderNews() {
            const listElement = document.getElementById('latest-news-list');
            if (!listElement || !isDbReady) return;

            const newsRef = ref(database, 'news');
            onValue(newsRef, (snapshot) => {
                listElement.innerHTML = '';
                let items = [];
                const data = snapshot.val();
                
                if (data) {
                    Object.values(data).forEach(item => {
                        // Filter out items where category is 'image'
                        if (item.category && item.category.toLowerCase() !== 'image') {
                            items.push(item);
                        } else if (!item.category) {
                            // Also include items with no category defined
                            items.push(item);
                        }
                    });
                }
                
                if (items.length === 0) {
                    listElement.innerHTML = '<div class="text-sm text-gray-500">No recent news available.</div>';
                    return;
                }

                items.sort((a, b) => new Date(b.date) - new Date(a.date));
                items = items.slice(0, 3);
                
                items.forEach(item => {
                    const div = document.createElement('div');
                    div.className = "border-b pb-2 pt-2";
                    const category = item.category ? item.category.toUpperCase() : 'GENERAL';
                    div.innerHTML = `
                        <span class="text-xs school-accent-text font-semibold uppercase block">${item.date || 'N/A'} | ${category}</span>
                        <a href="${item.url || '#'}" class="font-bold text-gray-800 hover:school-primary-text transition duration-150 text-sm">${item.title}</a>
                    `;
                    listElement.appendChild(div);
                });
            }, (error) => {
                console.error('Database Error:', error);
                listElement.innerHTML = '<div class="text-sm text-red-500">Error loading news.</div>';
            });
        }

        function fetchAndRenderCirculars() {
            const listElement = document.getElementById('official-circulars-list');
            if (!listElement || !isDbReady) return;

            const circularsRef = ref(database, 'circulars');
            onValue(circularsRef, (snapshot) => {
                listElement.innerHTML = '';
                let items = [];
                const data = snapshot.val();
                
                if (data) items = Object.values(data);
                
                if (items.length === 0) {
                    listElement.innerHTML = '<li class="text-sm text-gray-500 p-2">No circulars available.</li>';
                    return;
                }

                items.sort((a, b) => new Date(b.date) - new Date(a.date));
                items = items.slice(0, 4);
                
                items.forEach(item => {
                    const li = document.createElement('li');
                    li.className = "p-2 border-b border-gray-100 hover:bg-gray-50 rounded-md";
                    const newTag = item.isNew ? '<span class="text-xs school-accent-text font-bold mr-1">New!</span>' : '';
                    li.innerHTML = `
                        ${newTag}
                        <a href="${item.url || '#'}" class="text-gray-800 text-sm">${item.title}</a>
                        <span class="text-xs text-gray-500 block">Date: ${item.date || 'N/A'}</span>
                    `;
                    listElement.appendChild(li);
                });
            }, (error) => {
                console.error('Database Error:', error);
                listElement.innerHTML = '<li class="text-sm text-red-500 p-2">Error loading circulars.</li>';
            });
        }

        function fetchAndRenderGallery() {
            const galleryContainer = document.getElementById('gallery-grid');
            if (!galleryContainer || !isDbReady) return;

            const galleryRef = ref(database, 'gallery');
            onValue(galleryRef, (snapshot) => {
                galleryContainer.innerHTML = '';
                const data = snapshot.val();
                
                if (!data) {
                    galleryContainer.innerHTML = '<div class="col-span-full text-center text-gray-500 py-10">No gallery items available.</div>';
                    return;
                }

                // Convert object to array and render
                Object.values(data).forEach(item => {
                    // Create the anchor wrapper
                    const link = document.createElement('a');
                    link.href = item.url || '#';
                    link.className = "block w-full h-full";
                    
                    // Create the inner item structure
                    link.innerHTML = `
                        <div class="gallery-item">
                            <img class="w-full h-auto object-cover aspect-[4/3]" 
                                 src="${item.image || 'https://placehold.co/400x300?text=No+Image'}" 
                                 alt="${item.title || 'Gallery Image'}">
                            <div class="gallery-caption">${item.title || 'Untitled'}</div>
                        </div>
                    `;
                    galleryContainer.appendChild(link);
                });
            }, (error) => {
                console.error('Database Error:', error);
                galleryContainer.innerHTML = '<div class="col-span-full text-center text-red-500 py-10">Error loading gallery.</div>';
            });
        }
        
        // FINAL FIX: Celebration Animation Logic (USING PURE JS/CSS METHOD)
        function triggerCelebrationAnimation() {
            const overlay = document.getElementById('celebration-overlay');
            if (!overlay) return;

            const confettiCharacters = ['üéâ', 'üéà', '‚ú®', '‚≠ê', 'üèÜ', 'üíØ', 'üíô', 'üü°'];
            const numParticles = 80; 
            const duration = 10; // **MODIFIED: Increased from 3500ms to 6000ms for a slower animation**

            // Show the overlay
            overlay.classList.remove('hidden');
            overlay.innerHTML = ''; 

            for (let i = 0; i < numParticles; i++) {
                const particle = document.createElement('div');
                particle.className = 'confetti-particle';
                particle.textContent = confettiCharacters[Math.floor(Math.random() * confettiCharacters.length)];

                // Initial position: center of the screen, slightly randomized
                const startX = (Math.random() * 50) + 25; // 25% to 75%
                const startY = (Math.random() * 50) + 25; // 25% to 75%
                
                particle.style.left = startX + 'vw';
                particle.style.top = startY + 'vh';
                
                // Set initial transform (opacity and position for animation)
                particle.style.transform = `translate(0px, 0px) rotate(0deg)`;
                particle.style.opacity = 1;
                
                overlay.appendChild(particle);

                // Calculate final position
                const endY = window.innerHeight * 1.5; // Falls off screen
                const endXDrift = (Math.random() - 0.5) * window.innerWidth; // Drifts horizontally
                const rotation = (Math.random() * 1080) + 720; // Spins a few times

                // Set the transition property AFTER the element is placed with its starting styles
                particle.style.transition = `transform ${duration}ms cubic-bezier(0.1, 1, 0.5, 1), opacity ${duration}ms ease-out`;

                // Start the animation in the next event loop cycle
                setTimeout(() => {
                    particle.style.transform = `translate(${endXDrift}px, ${endY}px) rotate(${rotation}deg)`;
                    particle.style.opacity = 0;
                }, 50); 

                // Clean up the particle
                setTimeout(() => {
                    particle.remove();
                }, duration + 50); 
            }

            // Hide the overlay container after all animations are done (plus a buffer)
            setTimeout(() => {
                overlay.classList.add('hidden');
            }, duration + 500); 
        }
        // --- END: Final Pure JS Animation ---


        // --- UPDATED TOPPER FUNCTION (No change here, just calling the new function) ---
        function fetchAndRenderToppers() {
            const container = document.getElementById('toppers-list-container');
            if (!container || !isDbReady) return;
            
            // Set up a reference to the 'toppers' node
            const toppersRef = ref(database, 'toppers');
            
            onValue(toppersRef, (snapshot) => {
                container.innerHTML = ''; 
                let items = [];
                const data = snapshot.val();
                
                if (data) {
                    items = Object.values(data);
                    items.sort((a, b) => (a.order || 0) - (b.order || 0));
                }
                
                if (items.length === 0) {
                    container.innerHTML = '<div class="flex-shrink-0 w-full text-center text-gray-500 py-10">No academic toppers have been added yet.</div>';
                    return;
                }
                
                items.forEach(item => {
                    const name = item.name || 'Student Topper';
                    const percentage = item.percentage ? `${item.percentage}` : 'N/A';
                    const position = item.position || 'Merit';
                    const detail = item.detail || 'Academic Achievement'; 
                    const imageURL = item.imageURL || 'https://placehold.co/300x400/00b8e6/343a40?text=Topper'; 
                    
                    const card = document.createElement('div');
                    card.className = "topper-card rounded-lg bg-white shadow-lg flex-shrink-0"; 
                    
                    // Attach the animation trigger to the card
                    card.onclick = triggerCelebrationAnimation; 
                    
                    // Updated card structure for smaller, more concise display
                    card.innerHTML = `
                        <div class="text-center">
                            <div class="topper-image-container mb-1">
                                <img class="topper-image" 
                                     src="${imageURL}" 
                                     alt="${name}">
                                <div class="topper-caption">${name}</div>
                            </div>
                            <p class="school-primary-text text-xs font-extrabold leading-tight">${position}</p>
                            <p class="school-accent-text text-xs font-bold leading-tight">${percentage}</p>
                            <p class="text-[0.6rem] text-gray-600">${detail}</p>
                        </div>
                    `;
                    
                    container.appendChild(card);
                });

            }, (error) => {
                console.error('Database Error for Toppers:', error);
                container.innerHTML = '<div class="flex-shrink-0 w-full text-center text-red-500 py-10">Error loading toppers data.</div>';
            });
        }
        // --- END: UPDATED TOPPER FUNCTION ---
        
        // --- START: POPUP BANNER FUNCTION (NO CHANGE) ---
        function fetchAndRenderPopupBanner() {
            const container = document.getElementById('popup-banner-container');
            const closeBtn = document.getElementById('popup-close-btn');
            const link = document.getElementById('popup-link');
            const image = document.getElementById('popup-image');
            const banner = document.getElementById('popup-banner');

            if (!container || !isDbReady) return;

            const bannerRef = ref(database, 'popup_banner');
            onValue(bannerRef, (snapshot) => {
                const data = snapshot.val();
                
                if (data && data.isActive && data.imageURL) {
                    if (sessionStorage.getItem('mcs_popup_closed') === 'true') {
                        container.classList.add('hidden');
                        return;
                    }
                    
                    link.href = data.linkURL || '#';
                    image.src = data.imageURL;
                    image.alt = data.title || 'Popup Banner';
                    
                    container.classList.remove('hidden');
                    banner.classList.remove('animate-scale-out'); 
                    setTimeout(() => {
                        banner.classList.add('animate-scale-in');
                    }, 50); 

                } else {
                    container.classList.add('hidden');
                    banner.classList.remove('animate-scale-in');
                    banner.classList.remove('animate-scale-out');
                }
            }, (error) => {
                console.error('Database Error:', error);
            });

            closeBtn.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation(); 
                
                banner.classList.remove('animate-scale-in');
                banner.classList.add('animate-scale-out');
                
                setTimeout(() => {
                    container.classList.add('hidden');
                    sessionStorage.setItem('mcs_popup_closed', 'true');
                }, 300);
            });

            container.addEventListener('click', (e) => {
                if (e.target === container) {
                    closeBtn.click(); 
                }
            });
        }
        // --- END: POPUP BANNER FUNCTION (NO CHANGE) ---

        async function initApp() {
            try {
                const app = initializeApp(firebaseConfig);
                database = getDatabase(app);
                isDbReady = true;
                
                console.log("Realtime Database connected successfully!");

                fetchAndRenderMarqueeNotices();
                fetchAndRenderSimpleList('academic_links', 'academic-links-list', 'sidebar-link');
                fetchAndRenderSimpleList('downloads', 'downloads-list', 'sidebar-link');
                fetchAndRenderNews();
                fetchAndRenderCirculars();
                fetchAndRenderGallery(); 
                fetchAndRenderToppers(); 
                fetchAndRenderPopupBanner(); 
                
            } catch (error) {
                console.error("Firebase initialization failed:", error);
                const errorMessage = "Error: Database connection failed. (Check console for details)";
                document.getElementById('marquee-notices').textContent = errorMessage;
                document.getElementById('latest-news-list').innerHTML = `<div class=\"text-sm text-red-500\">${errorMessage}</div>`;
                document.getElementById('official-circulars-list').innerHTML = `<li class=\"text-sm text-red-500 p-2\">${errorMessage}</li>`;
                document.getElementById('academic-links-list').innerHTML = `<li class=\"text-sm text-red-500 p-2\">${errorMessage}</li>`;
                document.getElementById('downloads-list').innerHTML = `<li class=\"text-sm text-red-500 p-2\">${errorMessage}</li>`;
                
                const galleryErr = document.getElementById('gallery-grid');
                if(galleryErr) galleryErr.innerHTML = `<div class=\"col-span-full text-center text-red-500 py-10\">${errorMessage}</div>`;
                
                const toppersErr = document.getElementById('toppers-list-container');
                if(toppersErr) toppersErr.innerHTML = `<div class=\"flex-shrink-0 w-full text-center text-red-500 py-10\">${errorMessage}</div>`;
            }
            
            document.getElementById('mobile-menu-btn').addEventListener('click', function() {
                const menu = document.getElementById('mobile-menu');
                menu.classList.toggle('hidden');
            });
        }

        window.onload = initApp;
    </script>

</body>
</html>


